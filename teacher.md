Okay, here is the updated API documentation specifically for the **Teacher** role, based on the corrected `teacher.py` code which handles different question types and validation correctly.

---

## Online Exam Portal - Teacher API Documentation (Updated)

**Base URL:** (Your running server, e.g., `http://127.0.0.1:5000`)

**Authentication:** All Teacher endpoints require:

1.  A valid JWT Access Token in the `Authorization: Bearer <TOKEN>` header.
2.  The user associated with the token must have the `Teacher` role (verified via custom claims).
3.  The user associated with the token must be `verified` (checked against the database).

---

### üë©‚Äçüè´ Teacher APIs

| Method | Endpoint                                             | Description                                                    | Request Body (JSON)                                                                                                                                                              | Path/Query Params             | Success Response (200/201)                                                                                                                                                                                                                                                                                                                         | Error Responses                                                                                                                                                                                                      |
| :----- | :--------------------------------------------------- | :------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| GET    | `/teacher/dashboard`                                 | Get teacher dashboard statistics.                              | None                                                                                                                                                                             | None                          | `{"message": "Teacher Dashboard", "my_exams_count": 12}`                                                                                                                                                                                                                                                                            | `401 Unauthorized` (No/Invalid Token, Missing/Invalid Claims), `403 Forbidden` (Wrong Role/Not Verified)                                                                                                             |
| POST   | `/teacher/exams`                                     | Create a new exam.                                             | `{"title": "Chapter 6 Quiz", "description": "Covers Topic X.", "scheduled_time": "2024-11-01T14:00:00Z", "duration": 45}` *(Use ISO 8601 UTC format for time)*              | None                          | `{"msg": "Exam created successfully", "exam": {"id": 30, "title": "Chapter 6 Quiz"}}`                                                                                                                                                                                                                                               | `401/403`, `400 Bad Request` (Missing fields, invalid time/duration format)                                                                                                                                        |
| GET    | `/teacher/exams`                                     | Get all exams created by this teacher (ordered by schedule desc). | None                                                                                                                                                                             | None                          | `[{"id": 30, "title": "Chapter 6 Quiz", ..., "created_at": "..."}, {"id": 25, ...}]`                                                                                                                                                                                                                                               | `401/403`                                                                                                                                                                                                            |
| GET    | `/teacher/exams/<exam_id>`                           | Get details of a specific exam created by this teacher.        | None                                                                                                                                                                             | `exam_id` (int)               | `{"id": 30, "title": "Chapter 6 Quiz", "description": "...", "scheduled_time": "...", "duration": 45}`                                                                                                                                                                                                                                | `401/403`, `404 Not Found` (Exam ID not found or not owned by teacher)                                                                                                                                            |
| PUT    | `/teacher/exams/<exam_id>`                           | Update an exam's details.                                      | `{ "description": "Updated desc.", "duration": 50 }` *(Send only fields to update)*                                                                                              | `exam_id` (int)               | `{"msg": "Exam updated successfully"}`                                                                                                                                                                                                                                                                                                | `401/403`, `404 Not Found`, `400 Bad Request` (Invalid data format, no changes provided)                                                                                                                           |
| DELETE | `/teacher/exams/<exam_id>`                           | Delete an exam and all its related questions/responses.        | None                                                                                                                                                                             | `exam_id` (int)               | `{"msg": "Exam and associated data deleted successfully"}`                                                                                                                                                                                                                                                                         | `401/403`, `404 Not Found`                                                                                                                                                                                         |
| POST   | `/teacher/exams/<exam_id>/questions`                 | Add a question to a specific exam.                             | **MCQ:**<br/>`{"question_text": "Q1 Text?", "question_type": "MCQ", "marks": 2, "options": {"A": "Opt A", "B": "Opt B", "C": "Opt C"}, "correct_answer": "B"}`<br/>**Short Answer:**<br/>`{"question_text": "Q2 Text?", "question_type": "Short Answer", "marks": 5, "word_limit": 100}`<br/>**Long Answer:**<br/>`{"question_text": "Q3 Text?", "question_type": "Long Answer", "marks": 10}` *(word_limit optional)* | `exam_id` (int)               | `{"msg": "Question added successfully", "question": {"id": 110, "question_text": "...", "question_type": "MCQ", "marks": 2, "options": {...}, "correct_answer": "B", "word_limit": null}}`                                                                                                                                              | `401/403`, `404 Not Found` (Exam), `400 Bad Request` (Missing fields, invalid `question_type` string, invalid `marks`, invalid `options`/`correct_answer` for MCQ, invalid `word_limit` for Short/Long Answer)     |
| GET    | `/teacher/exams/<exam_id>/questions`                 | Get all questions for a specific exam (ordered by ID).         | None                                                                                                                                                                             | `exam_id` (int)               | `[{"id": 110, "question_text": "...", "question_type": "MCQ", "marks": 2, "options": {...}, "correct_answer": "B", "word_limit": null}, {"id": 111, ..., "question_type": "Short Answer", ..., "options": null, "correct_answer": null, "word_limit": 100}]`                                                                              | `401/403`, `404 Not Found` (Exam)                                                                                                                                                                                  |
| PUT    | `/teacher/exams/<exam_id>/questions/<question_id>`   | Update a specific question.                                  | `{ "marks": 3, "question_text": "Updated Q1 Text?" }` *(Send only fields to update. If changing `question_type`, ensure required fields for the *new* type are included, e.g., `options` & `correct_answer` if changing TO "MCQ")* | `exam_id` (int), `question_id` (int) | `{"msg": "Question updated successfully", "question": {"id": 110, ...}}` *(Returns the updated question details)*                                                                                                                                                                                                                         | `401/403`, `404 Not Found` (Exam/Question), `400 Bad Request` (Invalid data, validation failure for type/fields, no actual changes provided)                                                                      |
| DELETE | `/teacher/exams/<exam_id>/questions/<question_id>`   | Delete a specific question from an exam.                     | None                                                                                                                                                                             | `exam_id` (int), `question_id` (int) | `{"msg": "Question deleted successfully"}`                                                                                                                                                                                                                                                                                       | `401/403`, `404 Not Found` (Exam/Question)                                                                                                                                                                       |
| GET    | `/teacher/exams/results/<exam_id>`                    | Get student results for a specific exam (grouped by student). | None                                                                                                                                                                             | `exam_id` (int)               | `[{"student_id": 4, "student_name": "Student One", "total_marks_awarded": 8.5, "total_marks_possible": 12, "details": [{ "question_id": 110, "question_type": "MCQ", ..., "marks_awarded": 1.0 }, {"question_id": 111, "question_type": "Short Answer", ..., "marks_awarded": null}, ...]}, ...]` *(marks_awarded can be null if not evaluated)* | `401/403`, `404 Not Found` (Exam)                                                                                                                                                                                  |

---

**Key Notes on Question Types:**

*   **`question_type` Field:** When sending data (`POST`/`PUT`), use the exact strings: `"MCQ"`, `"Short Answer"`, `"Long Answer"`. When receiving data (`GET`, or in `POST`/`PUT` responses), the API will also return these strings.
*   **MCQ Fields:** `options` (non-empty JSON object `{ "Key": "Value", ... }`) and `correct_answer` (string matching one of the keys in `options`) are **required** for `"MCQ"` type questions. `word_limit` will be ignored/set to null.
*   **Short/Long Answer Fields:** `options` and `correct_answer` will be ignored/set to null. `word_limit` is **optional**; if provided, it must be a positive integer.
*   **Updating Question Type:** Be careful when changing the `question_type` via `PUT`. You must provide the fields required by the *new* type in the same request (e.g., providing `options` and `correct_answer` when changing *to* `"MCQ"`). The API will handle nullifying fields that are not relevant to the new type.